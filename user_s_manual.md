# クラブ登録受付自動処理・チェックツール 取扱説明書

## 1. システム概要

本システムは、総合型地域スポーツクラブの登録・認証業務を効率化するためのPythonツール群です。  
受付内容や提出書類の自動チェック、チェックリストの自動生成、進捗管理などを一括で行います。

---

## 2. ファイル・フォルダ構成

- main.py  
  システムのメインエントリーポイント。全自動処理の起動スクリプトです。

- src  
  ソースコード一式。  
  - `core/` … ログ・パス設定・共通ユーティリティ
  - `data_processing/` … データ前処理・マージ・受付状況管理
  - `checklist/` … チェックリスト生成・自動チェック・一貫性チェック
  - `folder_management/` … フォルダ作成・管理

- config  
  設定ファイル（カラム定義JSONなど）

- data  
  入力データ（Excel等）

- output  
  出力データ（チェックリスト・ログ等）

---

## 3. 必要な環境

- Python 3.10 以上
- 必要なパッケージは requirements.txt で管理  
  インストール例：  
  ```sh
  pip install -r requirements.txt
  ```

---

## 4. 基本的な使い方

1. **データ準備**  
   data フォルダに受付データやクラブ情報データを配置します。

2. **main.pyの実行**  
   ターミナルで以下を実行します。
   ```sh
   python main.py
   ```
   ※初回実行時は必要なフォルダが自動生成されます。

3. **処理の流れ**  
   - ログ・フォルダの初期化
   - 受付データの最新ファイル検出・前処理
   - クラブ情報とのマージ
   - 受付状況の更新
   - クラブごとの詳細フォルダ作成
   - チェックリスト自動生成
   - 自動チェック・進捗管理
   - ログファイルの保存

4. **出力物の確認**  
   output 配下に各種チェックリストやログが出力されます。

---

## 5. 主な機能詳細

### 5.1 受付データの処理

- 最新の受付データファイルを自動検出し、必要なカラム名修正やデータ整形を行います。
- クラブ情報とマージし、受付状況を更新します。

### 5.2 チェックリストの自動生成

- クラブごとにチェックリストを自動生成します。
- 活動種目の一貫性チェックリストも自動作成されます（make_consistency_checklist_disciplines.py参照）。

### 5.3 自動チェック・進捗管理

- チェックリストの自動判定項目を自動で埋めます。
- チェック状況に応じて進捗管理ファイルを更新します。

---

## 6. トラブルシューティング

- **エラーが出た場合**  
  output 配下のログファイル（例: `logs/log_YYYYMMDDHHMMSS.txt`）を確認してください。

- **データが反映されない場合**  
  入力データのファイル名・カラム名が正しいか、config 配下の設定ファイルが最新か確認してください。

- **カラム名エラー**  
  データのカラム名が想定と異なる場合、`src/core/column_names.py` などで定義を確認してください。

---

## 7. よくある質問

- **Q. どのファイルを編集すればよいですか？**  
  基本的には data 配下の入力データと、必要に応じて config の設定ファイルのみ編集してください。

- **Q. チェックリストのカラムを追加したい**  
  consistency_checklist_disciplines_columns.json を編集し、必要なカラムを追加してください。

---

## 8. 手作業で入力・編集が必要な箇所

本システムは多くの処理を自動化していますが、以下の部分は手作業での入力・編集が必要です。

### 8.1 入力データの準備

- `data` フォルダに配置するExcelファイル（受付データ・クラブ情報データなど）は、  
  指定されたフォーマット・ファイル名で用意してください。
- ファイル名やシート名、カラム名が異なる場合は、エラーや正しく処理されない原因となります。

### 8.2 設定ファイルの編集

- `config` フォルダ内の各種設定ファイル（例: `consistency_checklist_disciplines_columns.json`）は、  
  チェックリストのカラム追加や仕様変更時に手作業で編集してください。
- 編集時はJSON形式の構文ミスに注意してください。

### 8.3 チェックリストの手動チェック欄

- 自動判定できない項目や「未チェック」となっている欄は、  
  出力されたExcelチェックリストを開き、担当者が直接入力・修正してください。
- チェック者名や備考欄も必要に応じて記入してください。

---

## 9. 補足

- 詳細な処理ロジックは各 `.py` ファイルのコメントや関数名を参照してください。
- コードのカスタマイズや拡張は、src 配下の該当モジュールを編集してください。